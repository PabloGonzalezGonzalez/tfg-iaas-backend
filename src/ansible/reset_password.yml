---
- name: Reset user's password
  hosts: "{{ vmName }}"
  remote_user: "{{ targetUsername }}"
  gather_facts: false

  # Variables
  vars_files:
    - ../files/pabloTFG.yaml
    - ../files/credentials.yaml

  vars:
    nodes: [ "{{ vmName }}" ]
    cluster: Cluster-Rojo

  # Pre-tasks
  pre_tasks:
    - name: Login to IaaS
      include_role:
        name: iaas_login
    - name: Start vm
      include_role:
        name: vm_start

  # Tasks
  # roles:
  tasks:
    - name: Reset password
      script: ./scripts/reset_password.sh "{{ username }}"

  # Post-tasks
  post_tasks:
    - name: Stop vm
      include_role:
        name: stop_vm
    - name: Logout from IaaS
      include_role:
        name: iaas_logout
