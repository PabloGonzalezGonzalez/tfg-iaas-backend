---
# tasks file for get_inventory
- name: Get all VM info
  ovirt_vm_info:
    auth: "{{ ovirt_auth }}"
    all_content: true
  register: vm_result

# TODO revisar para poner if (item.display.address) else
- name: Inventory list of VMs
  set_fact:
    #    vms: "{{ vms }} + ['name: {{ item.name }} ip: {{ item.display.address }}']"
    vms: "{{ vms }} + ['name: {{ item.name }} display: {{ item.display.monitors }}']"
  when: "item.name != 'HostedEngine'"
  with_items:
    "{{ vm_result.ovirt_vms }}"

- name: Copying the inventory to an external file
  copy:
    content="{{ vms | to_nice_yaml }}"
    dest=../files/inventory.yaml

#- name: Debug - show inventory
#  debug:
#    msg: "Inventory: {{ vms | to_nice_yaml(indent=3) }}"
